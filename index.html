<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storyboard AI - Smart Video Builder</title>
  <style>
    /* ============================================
       WIZARD CONTAINER & LAYOUT
       ============================================ */

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .wizard-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ============================================
       API KEY SECTION
       ============================================ */

    .api-key-section {
      grid-column: 1 / -1;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: 2px solid #e0e0e0;
    }

    .api-key-section.valid {
      border-color: #4caf50;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.02) 0%, rgba(76, 175, 80, 0.02) 100%);
    }

    .api-key-content {
      display: flex;
      gap: 15px;
      align-items: flex-end;
    }

    .api-key-group {
      flex: 1;
    }

    .api-key-label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .api-key-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      transition: all 0.3s ease;
    }

    .api-key-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .api-key-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 500;
      height: 20px;
      margin-top: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #999;
    }

    .status-dot.valid {
      background: #4caf50;
    }

    .status-text {
      color: #666;
    }

    .status-text.valid {
      color: #4caf50;
      font-weight: 600;
    }

    .api-key-help {
      font-size: 12px;
      color: #999;
      margin-top: 8px;
    }

    .api-key-help a {
      color: #667eea;
      text-decoration: none;
    }

    .api-key-help a:hover {
      text-decoration: underline;
    }

    /* ============================================
       PROGRESS BAR
       ============================================ */

    .wizard-progress {
      grid-column: 1 / -1;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .progress-bar {
      height: 4px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 20%;
      transition: width 0.3s ease;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .progress-step {
      flex: 1;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0.5;
    }

    .progress-step.active,
    .progress-step.completed {
      opacity: 1;
    }

    .step-number {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .progress-step.active .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .progress-step.completed .step-number {
      background: #4caf50;
      color: white;
    }

    .step-label {
      font-size: 12px;
      color: #666;
      font-weight: 500;
    }

    .progress-step.active .step-label,
    .progress-step.completed .step-label {
      color: #333;
      font-weight: 600;
    }

    /* ============================================
       WIZARD MAIN CONTENT
       ============================================ */

    .wizard-content {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      min-height: 600px;
    }

    .wizard-step {
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .wizard-step.hidden {
      display: none;
      opacity: 0;
    }

    .step-header {
      margin-bottom: 30px;
    }

    .step-header h2 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .step-description {
      color: #666;
      font-size: 16px;
    }

    /* ============================================
       STEP 1: BUSINESS TYPE
       ============================================ */

    .business-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .business-card {
      position: relative;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      background: white;
    }

    .business-card input[type="radio"] {
      display: none;
    }

    .business-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .business-card input[type="radio"]:checked + .business-icon {
      color: #667eea;
    }

    .business-card input[type="radio"]:checked ~ .business-name {
      color: #667eea;
      font-weight: bold;
    }

    .business-card input[type="radio"]:checked ~ .business-desc {
      color: #667eea;
    }

    .business-card.selected {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .business-icon {
      font-size: 40px;
      margin-bottom: 10px;
      transition: color 0.3s ease;
    }

    .business-name {
      font-weight: 600;
      color: #333;
      font-size: 14px;
      margin-bottom: 5px;
      transition: all 0.3s ease;
    }

    .business-desc {
      font-size: 11px;
      color: #999;
      transition: color 0.3s ease;
    }

    /* ============================================
       STEP 2: GENDER DEMOGRAPHICS
       ============================================ */

    .gender-selection {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .gender-option {
      position: relative;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.3s ease;
      background: white;
    }

    .gender-option input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .gender-content {
      flex: 1;
    }

    .gender-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .gender-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: bold;
      text-transform: uppercase;
      color: white;
    }

    .gender-badge.default {
      background: #2196F3;
    }

    .gender-badge.women {
      background: #E91E63;
    }

    .gender-badge.men {
      background: #1E88E5;
    }

    .gender-note {
      font-size: 13px;
      color: #999;
    }

    .gender-option:hover {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    }

    .gender-option input[type="radio"]:checked + .gender-content .gender-title {
      color: #667eea;
    }

    /* ============================================
       STEP 3: LOCATIONS
       ============================================ */

    .locations-section {
      margin-bottom: 30px;
    }

    .location-group,
    .location-group-secondary {
      margin-bottom: 25px;
    }

    .location-group h3,
    .location-group-secondary h3 {
      font-size: 14px;
      font-weight: 600;
      color: #667eea;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
    }

    .location-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 10px;
    }

    .location-checkbox {
      position: relative;
      cursor: pointer;
    }

    .location-checkbox input[type="checkbox"] {
      display: none;
    }

    .location-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      transition: all 0.3s ease;
      background: white;
      cursor: pointer;
    }

    .location-checkbox input[type="checkbox"]:checked + .location-label {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .location-label:hover {
      border-color: #667eea;
    }

    .location-group-secondary {
      opacity: 0.7;
    }

    .location-group-secondary h3 {
      opacity: 0.8;
    }

    .feature-question {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border-left: 4px solid #667eea;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .feature-question p {
      font-size: 14px;
      color: #333;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .feature-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .feature-btn {
      padding: 8px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .feature-btn:hover,
    .feature-btn.selected {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    /* ============================================
       WELLNESS SPECIALTIES
       ============================================ */

    .wellness-specialties {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .wellness-specialties.hidden {
      display: none;
    }

    .specialty-category {
      margin-bottom: 20px;
    }

    .specialty-category:last-child {
      margin-bottom: 0;
    }

    .specialty-category h4 {
      font-size: 13px;
      font-weight: 600;
      color: #667eea;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .specialty-checkboxes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
    }

    .specialty-checkbox {
      position: relative;
      cursor: pointer;
    }

    .specialty-checkbox input[type="checkbox"] {
      display: none;
    }

    .specialty-label {
      display: block;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      background: white;
      font-size: 12px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .specialty-checkbox input[type="checkbox"]:checked + .specialty-label {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* ============================================
       STEP 4: B-ROLL STRATEGY
       ============================================ */

    .broll-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .broll-card {
      position: relative;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      background: white;
    }

    .broll-card input[type="radio"] {
      display: none;
    }

    .broll-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .broll-card.recommended {
      border-color: #4caf50;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(76, 175, 80, 0.05) 100%);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
    }

    .broll-card input[type="radio"]:checked + .broll-header {
      color: #667eea;
    }

    .broll-card input[type="radio"]:checked ~ .broll-desc,
    .broll-card input[type="radio"]:checked ~ .broll-example {
      color: #667eea;
    }

    .broll-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
      transition: color 0.3s ease;
    }

    .broll-title {
      font-weight: 600;
      color: #333;
    }

    .broll-percent {
      font-size: 12px;
      background: #f0f0f0;
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap;
    }

    .broll-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .broll-example {
      font-size: 12px;
      color: #999;
      transition: color 0.3s ease;
    }

    .recommendation-box {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.05) 100%);
      border-left: 4px solid #4caf50;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .recommendation-content p {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 10px;
      color: #333;
    }

    .recommendation-content strong {
      color: #2e7d32;
    }

    /* ============================================
       STEP 5: BEHIND-THE-SCENES
       ============================================ */

    .bts-activities {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 30px;
    }

    .bts-checkbox {
      position: relative;
      cursor: pointer;
    }

    .bts-checkbox input[type="checkbox"] {
      display: none;
    }

    .bts-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .bts-checkbox input[type="checkbox"]:checked + .bts-label {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .bts-label:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }

    .bts-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .bts-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .bts-desc {
      font-size: 11px;
      opacity: 0.8;
    }

    /* ============================================
       PREVIEW CARDS
       ============================================ */

    .preview-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
      border: 2px dashed #667eea;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      font-size: 13px;
      color: #666;
    }

    .preview-card.populated {
      border-style: solid;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    }

    .preview-item {
      margin-bottom: 10px;
    }

    .preview-item:last-child {
      margin-bottom: 0;
    }

    .preview-label {
      font-weight: 600;
      color: #667eea;
    }

    .preview-value {
      color: #333;
    }

    /* ============================================
       STEP ACTIONS
       ============================================ */

    .step-actions {
      display: flex;
      gap: 10px;
      margin-top: 30px;
      justify-content: space-between;
    }

    .btn-back,
    .btn-next,
    .btn-generate {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-back {
      background: #f0f0f0;
      color: #666;
    }

    .btn-back:hover {
      background: #e0e0e0;
    }

    .btn-next,
    .btn-generate {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      margin-left: auto;
    }

    .btn-next:hover,
    .btn-generate:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .btn-generate {
      width: 100%;
      padding: 16px 24px;
      font-size: 16px;
    }

    .btn-generate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* ============================================
       SIDEBAR PREVIEW
       ============================================ */

    .wizard-preview-sidebar {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .preview-summary {
      font-size: 14px;
    }

    .preview-summary h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      gap: 10px;
    }

    .summary-label {
      font-weight: 600;
      color: #666;
    }

    .summary-value {
      color: #667eea;
      font-weight: 500;
      text-align: right;
      flex: 1;
    }

    .summary-divider {
      height: 1px;
      background: #e0e0e0;
      margin: 20px 0;
    }

    .recommendations-box {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .recommendations-box h4 {
      font-size: 13px;
      color: #667eea;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .recommendation-item {
      font-size: 12px;
      color: #555;
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .recommendation-item:last-child {
      margin-bottom: 0;
    }

    /* ============================================
       RESPONSIVE DESIGN
       ============================================ */

    @media (max-width: 1024px) {
      .wizard-container {
        grid-template-columns: 1fr;
      }

      .wizard-preview-sidebar {
        position: static;
      }

      .business-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .broll-options {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .api-key-content {
        flex-direction: column;
      }
    }

    @media (max-width: 768px) {
      .wizard-container {
        gap: 15px;
      }

      .wizard-content {
        padding: 25px;
        min-height: auto;
      }

      .step-header h2 {
        font-size: 22px;
      }

      .business-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }

      .gender-option {
        flex-direction: column;
        text-align: center;
      }

      .gender-title {
        flex-direction: column;
      }

      .location-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .bts-activities {
        grid-template-columns: repeat(2, 1fr);
      }

      .progress-steps {
        gap: 5px;
      }

      .step-label {
        font-size: 10px;
      }

      .step-actions {
        flex-direction: column;
      }

      .btn-back {
        order: 2;
      }

      .btn-next,
      .btn-generate {
        order: 1;
        margin-left: 0;
      }

      .api-key-content {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .wizard-container {
        grid-template-columns: 1fr;
        padding: 10px;
      }

      .wizard-progress {
        padding: 20px;
      }

      .wizard-content {
        padding: 20px;
        border-radius: 8px;
      }

      .step-header h2 {
        font-size: 18px;
      }

      .business-grid,
      .bts-activities {
        grid-template-columns: repeat(2, 1fr);
      }

      .gender-option {
        padding: 15px;
      }

      .location-grid {
        grid-template-columns: 1fr;
      }

      .step-actions {
        gap: 8px;
      }

      .btn-back,
      .btn-next,
      .btn-generate {
        padding: 10px 16px;
        font-size: 13px;
      }

      .api-key-content {
        flex-direction: column;
      }

      .api-key-section {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="wizard-container">
    <!-- API KEY SECTION -->
    <div class="api-key-section" id="apiKeySection">
      <div class="api-key-content">
        <div class="api-key-group" style="flex: 1;">
          <label class="api-key-label">üîë Perplexity API Key</label>
          <input 
            type="password" 
            id="apiKeyInput" 
            class="api-key-input" 
            placeholder="pplx-xxxxxxxxxxxxxxxxxxxxxxxx"
          >
          <div class="api-key-help">
            Get your key from <a href="https://www.perplexity.ai/settings/api" target="_blank">Perplexity Settings</a>
          </div>
        </div>
        <div class="api-key-group">
          <label class="api-key-label">&nbsp;</label>
          <button id="toggleApiVisibility" style="padding: 12px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">
            üëÅÔ∏è Show
          </button>
        </div>
      </div>
      <div class="api-key-status">
        <div class="status-dot" id="statusDot"></div>
        <span class="status-text" id="statusText">No API key entered</span>
      </div>
    </div>

    <!-- PROGRESS BAR -->
    <div class="wizard-progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-steps">
        <div class="progress-step active" data-step="1">
          <div class="step-number">1</div>
          <div class="step-label">Business Type</div>
        </div>
        <div class="progress-step" data-step="2">
          <div class="step-number">2</div>
          <div class="step-label">Gender Focus</div>
        </div>
        <div class="progress-step" data-step="3">
          <div class="step-number">3</div>
          <div class="step-label">Locations</div>
        </div>
        <div class="progress-step" data-step="4">
          <div class="step-number">4</div>
          <div class="step-label">B-Roll</div>
        </div>
        <div class="progress-step" data-step="5">
          <div class="step-number">5</div>
          <div class="step-label">Behind-the-Scenes</div>
        </div>
        <div class="progress-step" data-step="6">
          <div class="step-number">6</div>
          <div class="step-label">Brand & Voice</div>
        </div>
        <div class="progress-step" data-step="7">
          <div class="step-number">7</div>
          <div class="step-label">Review & Generate</div>
        </div>
      </div>
    </div>

    <!-- MAIN WIZARD -->
    <div class="wizard-content">
      
      <!-- STEP 1: BUSINESS TYPE -->
      <div class="wizard-step" id="step1" data-step="1">
        <div class="step-header">
          <h2>What's Your Business Type?</h2>
          <p class="step-description">This helps us tailor locations, activities, and B-roll recommendations</p>
        </div>

        <div class="business-grid">
          <label class="business-card" data-business="restaurant">
            <input type="radio" name="businessType" value="restaurant">
            <div class="business-icon">üçΩÔ∏è</div>
            <div class="business-name">Restaurant</div>
            <div class="business-desc">Fine dining, casual, or quick service</div>
          </label>

          <label class="business-card" data-business="cafe">
            <input type="radio" name="businessType" value="cafe">
            <div class="business-icon">‚òï</div>
            <div class="business-name">Cafe</div>
            <div class="business-desc">Coffee shop or bakery</div>
          </label>

          <label class="business-card" data-business="bar">
            <input type="radio" name="businessType" value="bar">
            <div class="business-icon">üç∏</div>
            <div class="business-name">Bar/Lounge</div>
            <div class="business-desc">Cocktail bar or lounge venue</div>
          </label>

          <label class="business-card" data-business="hotel">
            <input type="radio" name="businessType" value="hotel">
            <div class="business-icon">üè®</div>
            <div class="business-name">Hotel</div>
            <div class="business-desc">Hospitality & accommodations</div>
          </label>

          <label class="business-card" data-business="wellness">
            <input type="radio" name="businessType" value="wellness">
            <div class="business-icon">üí™</div>
            <div class="business-name">Wellness/Fitness</div>
            <div class="business-desc">Gym, studio, or wellness center</div>
          </label>

          <label class="business-card" data-business="education">
            <input type="radio" name="businessType" value="education">
            <div class="business-icon">üìö</div>
            <div class="business-name">Education</div>
            <div class="business-desc">Online course or training</div>
          </label>

          <label class="business-card" data-business="service_based">
            <input type="radio" name="businessType" value="service_based">
            <div class="business-icon">üéØ</div>
            <div class="business-name">Service-Based</div>
            <div class="business-desc">Coaching, consulting, freelance</div>
          </label>
        </div>

        <div class="step-actions">
          <button class="btn-next" id="next1">Next: Gender Focus ‚Üí</button>
        </div>
      </div>

      <!-- STEP 2: GENDER DEMOGRAPHICS -->
      <div class="wizard-step hidden" id="step2" data-step="2">
        <div class="step-header">
          <h2>Who Should Be in Your B-Roll?</h2>
          <p class="step-description">This helps us recommend the right talent and diversity approach</p>
        </div>

        <div class="gender-selection">
          <label class="gender-option">
            <input type="radio" name="gender" value="both" checked>
            <div class="gender-content">
              <div class="gender-title">
                <span class="gender-badge default">Default</span>
                Both Genders
              </div>
              <div class="gender-note">Natural diversity - shows inclusive workplace/community</div>
            </div>
          </label>

          <label class="gender-option">
            <input type="radio" name="gender" value="women">
            <div class="gender-content">
              <div class="gender-title">
                <span class="gender-badge women">Women Focus</span>
                Women-Focused
              </div>
              <div class="gender-note">For women's empowerment, women-only services, or women-led businesses</div>
            </div>
          </label>

          <label class="gender-option">
            <input type="radio" name="gender" value="men">
            <div class="gender-content">
              <div class="gender-title">
                <span class="gender-badge men">Men Focus</span>
                Men-Focused
              </div>
              <div class="gender-note">For men-specific services, men's groups, or men-led training</div>
            </div>
          </label>
        </div>

        <div class="preview-card" id="genderPreview">
          <!-- Dynamically populated -->
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back2">‚Üê Back</button>
          <button class="btn-next" id="next2">Next: Locations ‚Üí</button>
        </div>
      </div>

      <!-- STEP 3: LOCATIONS & SETTINGS -->
      <div class="wizard-step hidden" id="step3" data-step="3">
        <div class="step-header">
          <h2>Where Should We Film?</h2>
          <p class="step-description" id="locationDescription"></p>
        </div>

        <div class="locations-section">
          <div class="location-group" id="primaryLocations">
            <!-- Dynamically populated based on business type -->
          </div>

          <div class="location-group-secondary" id="secondaryLocations">
            <!-- Dynamically populated based on business type -->
          </div>

          <div id="wellnessSpecialties" class="wellness-specialties hidden">
            <!-- Only shows for wellness -->
          </div>
        </div>

        <div class="feature-question" id="featureQuestion">
          <!-- Dynamically populated -->
        </div>

        <div class="preview-card" id="locationPreview">
          <!-- Dynamically populated -->
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back3">‚Üê Back</button>
          <button class="btn-next" id="next3">Next: B-Roll Strategy ‚Üí</button>
        </div>
      </div>

      <!-- STEP 4: B-ROLL STRATEGY -->
      <div class="wizard-step hidden" id="step4" data-step="4">
        <div class="step-header">
          <h2>What's Your B-Roll Strategy?</h2>
          <p class="step-description">How much background footage supports your talking head content?</p>
        </div>

        <div class="broll-options">
          <label class="broll-card" data-broll="all">
            <input type="radio" name="brollStrategy" value="all">
            <div class="broll-header">
              <div class="broll-title">All B-Roll</div>
              <div class="broll-percent">0% Talking Head</div>
            </div>
            <div class="broll-desc">Pure visual storytelling, no host speaking</div>
            <div class="broll-example">üìπ Cinematic showcase reel</div>
            <div class="business-fit"></div>
          </label>

          <label class="broll-card" data-broll="mostly">
            <input type="radio" name="brollStrategy" value="mostly">
            <div class="broll-header">
              <div class="broll-title">Mostly B-Roll</div>
              <div class="broll-percent">20-30% Talking Head</div>
            </div>
            <div class="broll-desc">Host briefly introduces/concludes, B-roll shows action</div>
            <div class="broll-example">üé¨ Documentary-style with voiceover</div>
            <div class="business-fit"></div>
          </label>

          <label class="broll-card" data-broll="some">
            <input type="radio" name="brollStrategy" value="some">
            <div class="broll-header">
              <div class="broll-title">Some B-Roll</div>
              <div class="broll-percent">50% Talking Head, 50% B-Roll</div>
            </div>
            <div class="broll-desc">Balanced between host and visual storytelling</div>
            <div class="broll-example">üé• Interview with supporting footage</div>
            <div class="business-fit"></div>
          </label>

          <label class="broll-card" data-broll="none">
            <input type="radio" name="brollStrategy" value="none">
            <div class="broll-header">
              <div class="broll-title">No B-Roll</div>
              <div class="broll-percent">100% Talking Head</div>
            </div>
            <div class="broll-desc">Host-focused, minimal supplemental footage</div>
            <div class="broll-example">üì± Direct-to-camera content</div>
            <div class="business-fit"></div>
          </label>
        </div>

        <div class="recommendation-box" id="brollRecommendation">
          <!-- Dynamically filled based on business type -->
        </div>

        <div class="preview-card" id="brollPreview">
          <!-- Dynamically populated -->
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back4">‚Üê Back</button>
          <button class="btn-next" id="next4">Next: Behind-the-Scenes ‚Üí</button>
        </div>
      </div>

      <!-- STEP 5: BEHIND-THE-SCENES ACTIVITIES -->
      <div class="wizard-step hidden" id="step5" data-step="5">
        <div class="step-header">
          <h2>What Activities Should We Capture?</h2>
          <p class="step-description">Select all the behind-the-scenes moments that show your business in action</p>
        </div>

        <div class="bts-activities" id="btsActivities">
          <!-- Dynamically populated based on business type -->
        </div>

        <div class="preview-card" id="btsPreview">
          <!-- Dynamically populated -->
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back5">‚Üê Back</button>
          <button class="btn-next" id="next5">Next: Brand & Voice ‚Üí</button>
        </div>
      </div>

      <!-- STEP 6: BRAND & VOICE PROFILE -->
      <div class="wizard-step hidden" id="step6" data-step="6">
        <div class="step-header">
          <h2>Your Brand & Voice Identity</h2>
          <p class="step-description">Define your brand's unique story and cinematic voice</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
          <!-- Left Column: Business Info & UVP -->
          <div>
            <div style="margin-bottom: 25px;">
              <label class="api-key-label">Business Name</label>
              <input 
                type="text" 
                id="businessName" 
                class="api-key-input" 
                placeholder="e.g., Jerusalem Grill and Deli"
              >
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üéØ Hero Product/Focus</label>
              <input 
                type="text" 
                id="heroProduct" 
                class="api-key-input" 
                placeholder="e.g., Kufta Burgers, Barista Craft, Personal Training"
              >
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üåü What Makes You Different?</label>
              <textarea 
                id="differentiation" 
                class="api-key-input" 
                placeholder="30 years of hunger & hustle, hand-shaped, real ingredients only..."
                style="min-height: 80px; font-family: inherit; resize: vertical;"
              ></textarea>
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üö´ What Do You Refuse to Do?</label>
              <textarea 
                id="boundaries" 
                class="api-key-input" 
                placeholder="No frozen lies, no shortcuts, no processed BS..."
                style="min-height: 80px; font-family: inherit; resize: vertical;"
              ></textarea>
            </div>
          </div>

          <!-- Right Column: Emotion, Heritage, Links -->
          <div>
            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üí≠ Emotion You Want to Invoke</label>
              <input 
                type="text" 
                id="emotion" 
                class="api-key-input" 
                placeholder="e.g., Rebellion, Comfort, Discovery, Authenticity, Trust"
              >
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üìñ Origin Story (Optional)</label>
              <textarea 
                id="heritage" 
                class="api-key-input" 
                placeholder="Started in 1994 on Jerusalem streets, family recipe..."
                style="min-height: 80px; font-family: inherit; resize: vertical;"
              ></textarea>
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üåê Website</label>
              <input 
                type="url" 
                id="website" 
                class="api-key-input" 
                placeholder="https://yourwebsite.com"
              >
            </div>

            <div style="margin-bottom: 25px;">
              <label class="api-key-label">üì± Social Links</label>
              <input 
                type="url" 
                id="socialFacebook" 
                class="api-key-input" 
                placeholder="Facebook: https://facebook.com/yourpage"
                style="margin-bottom: 10px;"
              >
              <input 
                type="url" 
                id="socialInstagram" 
                class="api-key-input" 
                placeholder="Instagram: https://instagram.com/yourhandle"
              >
            </div>
          </div>
        </div>

        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%); border-left: 4px solid #667eea; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
          <h3 style="font-size: 16px; color: #333; margin-bottom: 15px; font-weight: 600;">Choose Your Voice Tone</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <label style="position: relative; cursor: pointer;">
              <input type="radio" name="toneStyle" value="cynical_witty" style="display: none;">
              <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; text-align: center; transition: all 0.3s ease; background: white;">
                <div style="font-size: 20px; margin-bottom: 8px;">üòè</div>
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">Cynical & Witty</div>
                <div style="font-size: 12px; color: #999;">Dry humor, street-smart digs</div>
              </div>
            </label>
            <label style="position: relative; cursor: pointer;">
              <input type="radio" name="toneStyle" value="introspective_poetic" style="display: none;">
              <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; text-align: center; transition: all 0.3s ease; background: white;">
                <div style="font-size: 20px; margin-bottom: 8px;">üåô</div>
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">Introspective & Poetic</div>
                <div style="font-size: 12px; color: #999;">Deep musings, sensory metaphors</div>
              </div>
            </label>
            <label style="position: relative; cursor: pointer;">
              <input type="radio" name="toneStyle" value="adventurous_bold" style="display: none;">
              <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; text-align: center; transition: all 0.3s ease; background: white;">
                <div style="font-size: 20px; margin-bottom: 8px;">‚ö°</div>
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">Adventurous & Bold</div>
                <div style="font-size: 12px; color: #999;">High-energy rants, dare-you</div>
              </div>
            </label>
            <label style="position: relative; cursor: pointer;">
              <input type="radio" name="toneStyle" value="nostalgic_warm" style="display: none;">
              <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; text-align: center; transition: all 0.3s ease; background: white;">
                <div style="font-size: 20px; margin-bottom: 8px;">üî•</div>
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">Nostalgic & Warm</div>
                <div style="font-size: 12px; color: #999;">Sentiment under sarcasm</div>
              </div>
            </label>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
          <div>
            <label class="api-key-label">üë• Primary Audience Age</label>
            <select id="ageRange" class="api-key-input" style="cursor: pointer;">
              <option value="">Select age range...</option>
              <option value="18-25">18-25 (Gen Z)</option>
              <option value="25-35">25-35 (Millennials)</option>
              <option value="35-50">35-50 (Gen X)</option>
              <option value="50+">50+ (Boomers)</option>
              <option value="all-ages">All Ages</option>
            </select>
          </div>

          <div>
            <label class="api-key-label">üéØ Audience Type</label>
            <select id="psychographic" class="api-key-input" style="cursor: pointer;">
              <option value="">Select audience type...</option>
              <option value="foodies">Foodies & Food Lovers</option>
              <option value="entrepreneurs">Entrepreneurs & Business Owners</option>
              <option value="health-conscious">Health Conscious & Wellness</option>
              <option value="local-community">Local Community Members</option>
              <option value="professionals">Professionals & Corporate</option>
              <option value="adventure-seekers">Adventure Seekers</option>
              <option value="mixed">Mixed Audience</option>
            </select>
          </div>
        </div>

        <div id="tonePreview" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); border: 2px dashed #667eea; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
          <p style="color: #999; font-size: 13px;">Voice tone preview will appear here...</p>
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back6">‚Üê Back</button>
          <button class="btn-next" id="next6">Next: Review & Generate ‚Üí</button>
        </div>
      </div>

      <!-- STEP 7: REVIEW & GENERATE -->
      <div class="wizard-step hidden" id="step7" data-step="7">
        <div class="step-header">
          <h2>Review Your Production Brief</h2>
          <p class="step-description">Everything looks good? Generate your AI-powered storyboard & PDF</p>
        </div>

        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); border: 2px solid #667eea; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <!-- Left Side: Business Profile -->
            <div>
              <h3 style="font-size: 16px; color: #333; margin-bottom: 15px; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Business Profile</h3>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Business:</span>
                <span id="reviewBusiness" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Hero Product:</span>
                <span id="reviewProduct" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Unique Value:</span>
                <span id="reviewDiff" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Emotion Target:</span>
                <span id="reviewEmotion" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Website:</span>
                <a id="reviewWebsite" href="#" target="_blank" style="color: #667eea; text-decoration: none; margin-left: 5px;">‚Äî</a>
              </div>
            </div>

            <!-- Right Side: Production Settings -->
            <div>
              <h3 style="font-size: 16px; color: #333; margin-bottom: 15px; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Production Settings</h3>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Locations:</span>
                <span id="reviewLocations" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">B-Roll Strategy:</span>
                <span id="reviewBroll" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>
              
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Voice Tone:</span>
                <span id="reviewTone" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Target Audience:</span>
                <span id="reviewAudience" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-weight: 600; color: #667eea;">Activities:</span>
                <span id="reviewActivities" style="color: #333; margin-left: 5px;">‚Äî</span>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-bottom: 30px;">
          <label class="api-key-label">Number of Scenes (2-5)</label>
          <select id="sceneCount" class="api-key-input" style="cursor: pointer;">
            <option value="2">2 Scenes (Quick Video)</option>
            <option value="3" selected>3 Scenes (Balanced)</option>
            <option value="4">4 Scenes (Detailed)</option>
            <option value="5">5 Scenes (Epic Production)</option>
          </select>
        </div>

        <div class="step-actions">
          <button class="btn-back" id="back7">‚Üê Back</button>
          <button class="btn-generate" id="finalGenerate">
            üé¨ Generate Storyboard & PDF
          </button>
        </div>
      </div>

    </div>

    <!-- SIDE PREVIEW PANEL -->
    <aside class="wizard-preview-sidebar">
      <div class="preview-summary">
        <h3>Your Video Summary</h3>
        
        <div class="summary-item">
          <span class="summary-label">Business:</span>
          <span class="summary-value" id="summaryBusiness">Not selected</span>
        </div>

        <div class="summary-item">
          <span class="summary-label">Gender Focus:</span>
          <span class="summary-value" id="summaryGender">Both Genders</span>
        </div>

        <div class="summary-item">
          <span class="summary-label">Primary Location:</span>
          <span class="summary-value" id="summaryLocation">Not selected</span>
        </div>

        <div class="summary-item">
          <span class="summary-label">B-Roll Strategy:</span>
          <span class="summary-value" id="summaryBroll">Not selected</span>
        </div>

        <div class="summary-item">
          <span class="summary-label">Activities:</span>
          <span class="summary-value" id="summaryActivities">0 selected</span>
        </div>

        <div class="summary-divider"></div>

        <div class="recommendations-box" id="recommendationsBox">
          <h4>üí° Recommendations</h4>
          <div id="recommendationsList"></div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ============================================
    // API KEY MANAGEMENT
    // ============================================

    const apiKeyInput = document.getElementById('apiKeyInput');
    const toggleBtn = document.getElementById('toggleApiVisibility');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const apiKeySection = document.getElementById('apiKeySection');

    let apiKey = localStorage.getItem('perplexityApiKey') || '';

    // Load saved API key if exists
    if (apiKey) {
      apiKeyInput.value = apiKey;
      updateApiKeyStatus();
    }

    // Listen for API key input changes
    apiKeyInput.addEventListener('input', function() {
      apiKey = this.value;
      localStorage.setItem('perplexityApiKey', apiKey);
      updateApiKeyStatus();
    });

    // Toggle visibility
    toggleBtn.addEventListener('click', function() {
      if (apiKeyInput.type === 'password') {
        apiKeyInput.type = 'text';
        toggleBtn.textContent = 'üôà Hide';
      } else {
        apiKeyInput.type = 'password';
        toggleBtn.textContent = 'üëÅÔ∏è Show';
      }
    });

    function updateApiKeyStatus() {
      if (apiKey && apiKey.length > 10) {
        statusDot.classList.add('valid');
        statusText.classList.add('valid');
        statusText.textContent = '‚úì API key valid';
        apiKeySection.classList.add('valid');
      } else {
        statusDot.classList.remove('valid');
        statusText.classList.remove('valid');
        statusText.textContent = apiKey ? 'API key too short' : 'No API key entered';
        apiKeySection.classList.remove('valid');
      }
    }

    // ============================================
    // DATA STRUCTURES
    // ============================================

    const businessContextMap = {
      restaurant: {
        label: 'Restaurant',
        icon: 'üçΩÔ∏è',
        locations: {
          primary: ['Kitchen', 'Dining Area', 'Front Counter', 'Prep Station'],
          secondary: ['Storage', 'Bathroom', 'Entrance'],
          highlights: ['Kitchen (hero location)', 'Dining Area (lifestyle)'],
          featureQuestion: 'Which area best shows your value?'
        },
        behindTheScenes: [
          { id: 'prep', label: 'Food Preparation', icon: 'üî™', description: 'Ingredient sourcing, cutting, prep work' },
          { id: 'plating', label: 'Plating & Presentation', icon: 'üçΩÔ∏è', description: 'Plating technique, final touches' },
          { id: 'quality', label: 'Quality Checks', icon: '‚úÖ', description: 'Quality control, tasting, consistency' },
          { id: 'staff', label: 'Staff Training/Interaction', icon: 'üë•', description: 'Team working together, training moments' },
          { id: 'sourcing', label: 'Sourcing/Suppliers', icon: 'üì¶', description: 'Local sourcing, supplier relationships' }
        ],
        brollRecommendation: {
          recommended: 'mostly',
          reason: 'Food, ambiance, and action are visually compelling. Start with 30-sec intro from you, 90+ seconds of food prep, plating, dining experience.',
          percentage: '70% B-Roll'
        },
        peopleInBroll: ['Chefs', 'Kitchen Staff', 'Diners', 'Servers']
      },

      cafe: {
        label: 'Cafe',
        icon: '‚òï',
        locations: {
          primary: ['Counter', 'Seating Area', 'Kitchen/Bar', 'Patio'],
          secondary: ['Bathroom', 'Entrance', 'Waiting Area'],
          highlights: ['Counter (barista showcase)', 'Seating (community)'],
          featureQuestion: 'Cozy counter atmosphere or spacious seating?'
        },
        behindTheScenes: [
          { id: 'prep', label: 'Drink Preparation', icon: '‚òï', description: 'Espresso machine, milk steaming, latte art' },
          { id: 'pastries', label: 'Pastry/Food Prep', icon: 'ü•ê', description: 'Baking, arranging, presentation' },
          { id: 'customers', label: 'Customer Interaction', icon: 'üë•', description: 'Taking orders, chatting, service' },
          { id: 'atmosphere', label: 'Atmosphere/Community', icon: 'ü§ù', description: 'People gathering, cozy moments' }
        ],
        brollRecommendation: {
          recommended: 'mostly',
          reason: 'Showcase the cozy atmosphere, barista craft, and customer experience.',
          percentage: '70% B-Roll'
        },
        peopleInBroll: ['Baristas', 'Customers', 'Staff']
      },

      bar: {
        label: 'Bar/Lounge',
        icon: 'üç∏',
        locations: {
          primary: ['Bar Counter', 'Seating/Booths', 'Dance Floor', 'Lounge'],
          secondary: ['Bathroom', 'Entrance', 'Private Room'],
          highlights: ['Bar Counter (bartender skills)', 'Atmosphere (vibe)'],
          featureQuestion: 'What\'s your unique bar experience?'
        },
        behindTheScenes: [
          { id: 'cocktails', label: 'Cocktail Making', icon: 'üç∏', description: 'Mixing, pouring, garnishing techniques' },
          { id: 'atmosphere', label: 'Atmosphere & Vibes', icon: '‚ú®', description: 'Lighting, music, crowd energy' },
          { id: 'service', label: 'Service Excellence', icon: 'üõéÔ∏è', description: 'Staff interaction, customer care' },
          { id: 'events', label: 'Events/Entertainment', icon: 'üé§', description: 'DJ sets, live music, events' }
        ],
        brollRecommendation: {
          recommended: 'some',
          reason: 'Mix your personality (talking head) with bartending craft and atmosphere.',
          percentage: '50-60% B-Roll'
        },
        peopleInBroll: ['Bartenders', 'Staff', 'Customers']
      },

      hotel: {
        label: 'Hotel',
        icon: 'üè®',
        locations: {
          primary: ['Lobby', 'Guest Room', 'Restaurant', 'Conference'],
          secondary: ['Spa', 'Pool', 'Business Center', 'Concierge Desk'],
          highlights: ['Lobby (first impression)', 'Room (core product)'],
          featureQuestion: 'What\'s your signature experience?'
        },
        behindTheScenes: [
          { id: 'checkin', label: 'Check-In Process', icon: 'üîë', description: 'Welcoming guests, check-in experience' },
          { id: 'room', label: 'Room Setup/Amenities', icon: 'üõèÔ∏è', description: 'Showing room features and quality' },
          { id: 'service', label: 'Service Experience', icon: 'üõéÔ∏è', description: 'Concierge, room service, assistance' },
          { id: 'dining', label: 'Dining Experience', icon: 'üçΩÔ∏è', description: 'Restaurant, breakfast, room service' },
          { id: 'facility', label: 'Facility Tour', icon: 'üèä', description: 'Gym, spa, pool, conference facilities' }
        ],
        brollRecommendation: {
          recommended: 'mostly',
          reason: 'Show luxury, amenities, and service. You welcome guests, B-roll shows the experience.',
          percentage: '70% B-Roll'
        },
        peopleInBroll: ['Staff', 'Guests']
      },

      wellness: {
        label: 'Wellness/Fitness',
        icon: 'üí™',
        locations: {
          primary: ['Training Room', 'Recovery Room', 'Studio', 'Outdoor Space'],
          secondary: ['Changing Room', 'Lobby', 'Office'],
          specialty: ['Massage Room', 'Sauna', 'Cold Plunge', 'Equipment Hall'],
          specialtyQuestion: 'Any specialty wellness areas?',
          highlights: ['Training Room (main)', 'Recovery Room (unique selling point)'],
          featureQuestion: 'What\'s your signature wellness offering?'
        },
        specialtyCategories: {
          training: {
            name: 'Training Specialty',
            options: ['Personal Training', 'Group Fitness Classes', 'Yoga/Pilates', 'CrossFit/Strength', 'Cardio']
          },
          recovery: {
            name: 'Recovery & Wellness',
            options: ['Massage Therapy', 'Sauna/Steam', 'Cold Plunge', 'Stretching Room', 'Meditation/Mindfulness']
          },
          nutrition: {
            name: 'Nutrition Services',
            options: ['Nutrition Coaching', 'Meal Planning', 'Smoothie Bar', 'Healthy Cafe']
          },
          specialty: {
            name: 'Specialty Services',
            options: ['Physical Therapy', 'Sports Performance', 'Posture Analysis', 'Functional Movement', 'Rehabilitation']
          }
        },
        behindTheScenes: [
          { id: 'session', label: 'Client Training Session', icon: 'üí™', description: 'Active training, demonstrating form' },
          { id: 'transformation', label: 'Transformation/Results', icon: '‚ú®', description: 'Before/after progression, client wins' },
          { id: 'recovery', label: 'Recovery/Self-Care', icon: 'üßò', description: 'Massage, stretching, cool-down activities' },
          { id: 'equipment', label: 'Equipment Demo', icon: '‚öôÔ∏è', description: 'Using equipment, facility tour' },
          { id: 'nutrition', label: 'Nutrition/Wellness Talk', icon: 'ü•ó', description: 'Education component, health tips' },
          { id: 'community', label: 'Community/Group Dynamic', icon: 'ü§ù', description: 'Classes, group sessions, community feel' }
        ],
        brollRecommendation: {
          recommended: 'some',
          reason: 'You want to build trust with clients, so your presence matters, but show transformation/results with B-roll.',
          percentage: '50% B-Roll'
        },
        peopleInBroll: ['Clients', 'Staff', 'Athletes']
      },

      education: {
        label: 'Education',
        icon: 'üìö',
        locations: {
          primary: ['Classroom', 'Lab/Workshop', 'Studio', 'Office'],
          secondary: ['Library', 'Outdoor Space', 'Common Area'],
          highlights: ['Teaching Space', 'Lab Demo Area'],
          featureQuestion: 'Where does the learning magic happen?'
        },
        behindTheScenes: [
          { id: 'lecture', label: 'Lecture/Teaching', icon: 'üìö', description: 'Active teaching, explaining concepts' },
          { id: 'hands-on', label: 'Hands-On Demo', icon: 'üî¨', description: 'Practical demonstration, showing techniques' },
          { id: 'student', label: 'Student Engagement', icon: 'üë®‚Äçüéì', description: 'Students participating, asking questions' },
          { id: 'project', label: 'Project Work', icon: '‚öíÔ∏è', description: 'Students working on assignments' },
          { id: 'qa', label: 'Q&A / Discussion', icon: 'üí¨', description: 'Interactive questioning, dialogue' },
          { id: 'collaboration', label: 'Collaboration', icon: 'ü§≤', description: 'Group work, peer learning' }
        ],
        brollRecommendation: {
          recommended: 'mostly',
          reason: 'Let the learning in action speak. You frame it, but B-roll shows the magic.',
          percentage: '60-70% B-Roll'
        },
        peopleInBroll: ['Students', 'Instructors', 'Guest Experts']
      },

      service_based: {
        label: 'Service-Based',
        icon: 'üéØ',
        locations: {
          primary: ['Client Meeting Area', 'Work Station', 'Demo Space'],
          secondary: ['Office', 'Outdoor', 'Collaboration Space'],
          highlights: ['Main Service Area'],
          featureQuestion: 'Where do you deliver your service?'
        },
        behindTheScenes: [
          { id: 'consultation', label: 'Client Consultation', icon: 'üíº', description: 'Meeting with clients, discussing needs' },
          { id: 'demo', label: 'Service Demo', icon: 'üé¨', description: 'Showing your expertise in action' },
          { id: 'results', label: 'Results/Transformation', icon: '‚ú®', description: 'Client success, before/after' },
          { id: 'process', label: 'Your Process', icon: '‚öôÔ∏è', description: 'Behind-the-scenes work, methodology' },
          { id: 'tools', label: 'Tools/Resources', icon: 'üõ†Ô∏è', description: 'Showing what you use to deliver' }
        ],
        brollRecommendation: {
          recommended: 'some',
          reason: 'Balance your expertise on screen with shots showing your process and results.',
          percentage: '50% B-Roll'
        },
        peopleInBroll: ['Clients', 'Team Members', 'Collaborators']
      }
    };

    // ============================================
    // STATE MANAGEMENT
    // ============================================

    const formState = {
      businessType: '',
      gender: 'both',
      locations: [],
      selectedLocation: '',
      brollStrategy: '',
      behindTheScenes: [],
      wellnessSpecialties: [],
      currentStep: 1
    };

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    function updateProgress() {
      const progress = (formState.currentStep / 5) * 100;
      document.getElementById('progressFill').style.width = progress + '%';

      document.querySelectorAll('.progress-step').forEach((step, index) => {
        const stepNum = index + 1;
        step.classList.remove('active', 'completed');
        
        if (stepNum === formState.currentStep) {
          step.classList.add('active');
        } else if (stepNum < formState.currentStep) {
          step.classList.add('completed');
        }
      });
    }

    function showStep(stepNum) {
      document.querySelectorAll('.wizard-step').forEach(step => {
        step.classList.add('hidden');
      });

      document.getElementById('step' + stepNum).classList.remove('hidden');
      
      formState.currentStep = stepNum;
      updateProgress();
      updateSidebar();
    }

    function updateSidebar() {
      if (formState.businessType) {
        const label = businessContextMap[formState.businessType].label;
        document.getElementById('summaryBusiness').textContent = label;
      }

      const genderMap = { both: 'Both Genders', women: 'Women-Focused', men: 'Men-Focused' };
      document.getElementById('summaryGender').textContent = genderMap[formState.gender];

      if (formState.selectedLocation) {
        document.getElementById('summaryLocation').textContent = formState.selectedLocation;
      }

      const brollMap = { all: 'All B-Roll', mostly: 'Mostly B-Roll', some: 'Some B-Roll', none: 'No B-Roll' };
      if (formState.brollStrategy) {
        document.getElementById('summaryBroll').textContent = brollMap[formState.brollStrategy];
      }

      document.getElementById('summaryActivities').textContent = formState.behindTheScenes.length + ' selected';

      updateRecommendations();
    }

    function updateRecommendations() {
      const recommendationsList = document.getElementById('recommendationsList');
      const recommendations = [];

      if (formState.businessType && businessContextMap[formState.businessType]) {
        const brollRec = businessContextMap[formState.businessType].brollRecommendation;
        recommendations.push(`<div class="recommendation-item">üí° B-Roll: ${brollRec.percentage}</div>`);
      }

      if (formState.behindTheScenes.length > 0) {
        recommendations.push(`<div class="recommendation-item">üé¨ Activities: ${formState.behindTheScenes.length} selected</div>`);
      }

      if (formState.selectedLocation) {
        recommendations.push(`<div class="recommendation-item">üìç Hero location: ${formState.selectedLocation}</div>`);
      }

      recommendationsList.innerHTML = recommendations.join('');
    }

    // ============================================
    // STEP 1: BUSINESS TYPE
    // ============================================

    document.querySelectorAll('.business-card').forEach(card => {
      card.addEventListener('click', function() {
        document.querySelectorAll('.business-card').forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        
        const businessType = this.querySelector('input[name="businessType"]').value;
        formState.businessType = businessType;
        
        updateSidebar();
      });

      card.querySelector('input[name="businessType"]').addEventListener('change', function() {
        const businessType = this.value;
        formState.businessType = businessType;
        updateSidebar();
      });
    });

    document.getElementById('next1').addEventListener('click', () => {
      if (!formState.businessType) {
        alert('Please select a business type');
        return;
      }
      showStep(2);
    });

    // ============================================
    // STEP 2: GENDER DEMOGRAPHICS
    // ============================================

    document.querySelectorAll('input[name="gender"]').forEach(radio => {
      radio.addEventListener('change', function() {
        formState.gender = this.value;
        updateGenderPreview();
        updateSidebar();
      });
    });

    function updateGenderPreview() {
      const preview = document.getElementById('genderPreview');
      const genderInfo = {
        both: {
          title: 'Natural Diversity',
          description: 'Your video will feature both men and women in various roles, showing an inclusive workplace.',
          tip: 'Best for: General appeal, showing diversity and inclusion'
        },
        women: {
          title: 'Women-Focused Storytelling',
          description: 'Your B-roll will primarily feature women, highlighting their contributions and achievements.',
          tip: 'Best for: Women-empowerment brands, women-only services, women-led businesses'
        },
        men: {
          title: 'Men-Focused Storytelling',
          description: 'Your B-roll will primarily feature men, highlighting their participation and engagement.',
          tip: 'Best for: Men-specific services, men\'s groups, male-led initiatives'
        }
      };

      const info = genderInfo[formState.gender];
      preview.classList.add('populated');
      preview.innerHTML = `
        <div class="preview-item">
          <span class="preview-label">Focus:</span>
          <span class="preview-value">${info.title}</span>
        </div>
        <div class="preview-item">
          <span class="preview-label">Description:</span>
          <span class="preview-value">${info.description}</span>
        </div>
        <div class="preview-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(102, 126, 234, 0.2);">
          <span class="preview-label">üí° Tip:</span>
          <span class="preview-value">${info.tip}</span>
        </div>
      `;
    }

    document.getElementById('next2').addEventListener('click', () => {
      showStep(3);
      updateLocationPanel();
    });

    document.getElementById('back2').addEventListener('click', () => showStep(1));

    // ============================================
    // STEP 3: LOCATIONS
    // ============================================

    function updateLocationPanel() {
      const config = businessContextMap[formState.businessType];
      if (!config) return;

      document.getElementById('locationDescription').textContent = config.locations.featureQuestion;

      const primaryContainer = document.getElementById('primaryLocations');
      primaryContainer.innerHTML = '<h3>Primary Locations</h3>';
      const locationGrid = document.createElement('div');
      locationGrid.className = 'location-grid';

      config.locations.primary.forEach(loc => {
        const label = document.createElement('label');
        label.className = 'location-checkbox';
        label.innerHTML = `
          <input type="checkbox" value="${loc}" data-type="primary">
          <span class="location-label">${loc}</span>
        `;
        label.querySelector('input').addEventListener('change', function() {
          if (this.checked && formState.selectedLocation === '') {
            formState.selectedLocation = loc;
            formState.locations = [loc];
          } else if (!this.checked && formState.selectedLocation === loc) {
            formState.selectedLocation = '';
            formState.locations = [];
          }
          updateLocationPreview();
          updateSidebar();
        });
        locationGrid.appendChild(label);
      });

      primaryContainer.appendChild(locationGrid);

      if (config.locations.secondary && config.locations.secondary.length > 0) {
        const secondaryContainer = document.getElementById('secondaryLocations');
        secondaryContainer.innerHTML = '<h3>Other Areas</h3>';
        const secondaryGrid = document.createElement('div');
        secondaryGrid.className = 'location-grid';

        config.locations.secondary.forEach(loc => {
          const label = document.createElement('label');
          label.className = 'location-checkbox';
          label.innerHTML = `
            <input type="checkbox" value="${loc}" data-type="secondary">
            <span class="location-label">${loc}</span>
          `;
          label.querySelector('input').addEventListener('change', function() {
            if (this.checked && !formState.locations.includes(loc)) {
              formState.locations.push(loc);
            } else if (!this.checked) {
              formState.locations = formState.locations.filter(l => l !== loc);
            }
            updateLocationPreview();
          });
          secondaryGrid.appendChild(label);
        });

        secondaryContainer.appendChild(secondaryGrid);
      }

      const featureQuestion = document.getElementById('featureQuestion');
      featureQuestion.innerHTML = `
        <p>${config.locations.featureQuestion}</p>
        <div class="feature-options">
          ${config.locations.highlights.map(highlight => `
            <button class="feature-btn" data-highlight="${highlight}">
              ${highlight}
            </button>
          `).join('')}
        </div>
      `;

      document.querySelectorAll('.feature-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.feature-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          const highlight = this.getAttribute('data-highlight');
          formState.selectedLocation = highlight.split('(')[0].trim();
          updateLocationPreview();
          updateSidebar();
        });
      });

      if (formState.businessType === 'wellness' && config.specialtyCategories) {
        const specialtiesContainer = document.getElementById('wellnessSpecialties');
        specialtiesContainer.classList.remove('hidden');
        specialtiesContainer.innerHTML = '<h3>Specialty Wellness Areas</h3>';

        for (const [key, category] of Object.entries(config.specialtyCategories)) {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'specialty-category';
          categoryDiv.innerHTML = `<h4>${category.name}</h4>`;

          const checkboxesDiv = document.createElement('div');
          checkboxesDiv.className = 'specialty-checkboxes';

          category.options.forEach(option => {
            const label = document.createElement('label');
            label.className = 'specialty-checkbox';
            label.innerHTML = `
              <input type="checkbox" name="wellnessSpecialty" value="${option}">
              <span class="specialty-label">${option}</span>
            `;
            label.querySelector('input').addEventListener('change', function() {
              if (this.checked && !formState.wellnessSpecialties.includes(option)) {
                formState.wellnessSpecialties.push(option);
              } else if (!this.checked) {
                formState.wellnessSpecialties = formState.wellnessSpecialties.filter(s => s !== option);
              }
            });
            checkboxesDiv.appendChild(label);
          });

          categoryDiv.appendChild(checkboxesDiv);
          specialtiesContainer.appendChild(categoryDiv);
        }
      } else if (formState.businessType !== 'wellness') {
        document.getElementById('wellnessSpecialties').classList.add('hidden');
      }

      updateLocationPreview();
    }

    function updateLocationPreview() {
      const preview = document.getElementById('locationPreview');
      if (formState.locations.length > 0) {
        preview.classList.add('populated');
        preview.innerHTML = `
          <div class="preview-item">
            <span class="preview-label">Selected Locations:</span>
            <span class="preview-value">${formState.locations.join(', ')}</span>
          </div>
          <div class="preview-item">
            <span class="preview-label">Hero Location:</span>
            <span class="preview-value">${formState.selectedLocation || 'Not selected'}</span>
          </div>
        `;
      } else {
        preview.classList.remove('populated');
        preview.innerHTML = '<p>Select locations to see preview</p>';
      }
    }

    document.getElementById('next3').addEventListener('click', () => {
      if (formState.selectedLocation === '') {
        alert('Please select a primary location');
        return;
      }
      showStep(4);
      updateBrollPanel();
    });

    document.getElementById('back3').addEventListener('click', () => showStep(2));

    // ============================================
    // STEP 4: B-ROLL STRATEGY
    // ============================================

    function updateBrollPanel() {
      const config = businessContextMap[formState.businessType];
      const rec = config.brollRecommendation;

      const recBox = document.getElementById('brollRecommendation');
      recBox.innerHTML = `
        <div class="recommendation-content">
          <p><strong>‚ú® Recommended for ${config.label}:</strong> ${rec.recommended.toUpperCase()}</p>
          <p>${rec.reason}</p>
          <p><strong>Suggested ratio:</strong> ${rec.percentage}</p>
        </div>
      `;

      document.querySelectorAll('.broll-card').forEach(card => {
        card.classList.remove('recommended');
        const radio = card.querySelector('input[name="brollStrategy"]');
        if (radio.value === rec.recommended) {
          card.classList.add('recommended');
        }
      });
    }

    document.querySelectorAll('input[name="brollStrategy"]').forEach(radio => {
      radio.addEventListener('change', function() {
        formState.brollStrategy = this.value;
        updateBrollPreview();
        updateSidebar();
      });
    });

    function updateBrollPreview() {
      const preview = document.getElementById('brollPreview');
      if (formState.brollStrategy) {
        preview.classList.add('populated');
        const strategyMap = {
          all: 'Pure visual storytelling - no talking head',
          mostly: '20-30% talking head introduction/conclusion, rest is B-roll',
          some: '50% talking head mixed with 50% B-roll footage',
          none: '100% talking head with minimal B-roll'
        };
        preview.innerHTML = `
          <div class="preview-item">
            <span class="preview-label">Strategy:</span>
            <span class="preview-value">${strategyMap[formState.brollStrategy]}</span>
          </div>
        `;
      }
    }

    document.getElementById('next4').addEventListener('click', () => {
      if (!formState.brollStrategy) {
        alert('Please select a B-roll strategy');
        return;
      }
      showStep(5);
      updateBehindTheScenesPanel();
    });

    document.getElementById('back4').addEventListener('click', () => showStep(3));

    // ============================================
    // STEP 5: BEHIND-THE-SCENES
    // ============================================

    function updateBehindTheScenesPanel() {
      const config = businessContextMap[formState.businessType];
      const container = document.getElementById('btsActivities');
      container.innerHTML = '';

      config.behindTheScenes.forEach(activity => {
        const label = document.createElement('label');
        label.className = 'bts-checkbox';
        label.innerHTML = `
          <input type="checkbox" name="bts" value="${activity.id}">
          <div class="bts-label">
            <span class="bts-icon">${activity.icon}</span>
            <div class="bts-title">${activity.label}</div>
            <div class="bts-desc">${activity.description}</div>
          </div>
        `;

        label.querySelector('input').addEventListener('change', function() {
          if (this.checked) {
            formState.behindTheScenes.push(activity.id);
          } else {
            formState.behindTheScenes = formState.behindTheScenes.filter(id => id !== activity.id);
          }
          updateBtsPreview();
          updateSidebar();
        });

        container.appendChild(label);
      });

      updateBtsPreview();
    }

    function updateBtsPreview() {
      const preview = document.getElementById('btsPreview');
      if (formState.behindTheScenes.length > 0) {
        preview.classList.add('populated');
        preview.innerHTML = `
          <div class="preview-item">
            <span class="preview-label">Activities Selected:</span>
            <span class="preview-value">${formState.behindTheScenes.length}</span>
          </div>
        `;
      }
    }

    document.getElementById('generateStoryboard').addEventListener('click', async () => {
      // Check if API key is present
      if (!apiKey || apiKey.length < 10) {
        alert('‚ö†Ô∏è Please enter your Perplexity API key at the top of the form first.');
        apiKeyInput.focus();
        return;
      }

      console.log('Form State:', formState);
      
      // Build the prompt for Perplexity API
      const prompt = `You are an expert cinematographer and video producer. Based on the following business profile, generate a detailed shot list and storyboard breakdown for a talking head video with B-roll.

Business Type: ${formState.businessType}
Gender Focus: ${formState.gender}
Locations: ${formState.locations.join(', ')}
Hero Location: ${formState.selectedLocation}
B-Roll Strategy: ${formState.brollStrategy}
Behind-the-Scenes Activities: ${formState.behindTheScenes.join(', ')}
Wellness Specialties: ${formState.wellnessSpecialties.length > 0 ? formState.wellnessSpecialties.join(', ') : 'N/A'}

Please provide:
1. Overall video structure and timing breakdown
2. Recommended talking head placement and duration
3. B-roll shots to capture at each location
4. Specific shots for behind-the-scenes activities
5. Transitions and visual flow suggestions
6. Equipment and crew recommendations
7. Production tips specific to this business type`;

      try {
        // Show loading state
        const btn = document.getElementById('generateStoryboard');
        const originalText = btn.textContent;
        btn.textContent = '‚è≥ Generating...';
        btn.disabled = true;

        // Call Perplexity API
        const response = await fetch('https://api.perplexity.ai/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'sonar',
            messages: [
              {
                role: 'user',
                content: prompt
              }
            ],
            max_tokens: 2000
          })
        });

        if (!response.ok) {
          throw new Error('API request failed: ' + response.statusText);
        }

        const data = await response.json();
        const shotList = data.choices[0].message.content;

        // Display result in alert (or you can create a results modal)
        alert('üìπ YOUR SHOT LIST:\n\n' + shotList);

        btn.textContent = originalText;
        btn.disabled = false;
      } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Error generating shot list.\n\nError: ' + error.message);
        
        const btn = document.getElementById('generateStoryboard');
        btn.textContent = '‚ú® Generate My Shot List';
        btn.disabled = false;
      }
    });

    document.getElementById('back5').addEventListener('click', () => showStep(4));

    // ============================================
    // STEP 6: BRAND & VOICE PROFILE
    // ============================================

    const toneProfiles = {
      cynical_witty: {
        name: "Cynical & Witty",
        emoji: "üòè",
        description: "Dry humor, street-smart digs, irreverent takes",
        examples: ["No frozen lies. No shortcuts.", "Where thirty years of hunger and hustle get ground up", "A dare to forget the processed and the pretty"]
      },
      introspective_poetic: {
        name: "Introspective & Poetic",
        emoji: "üåô",
        description: "Deep musings, sensory metaphors, philosophical undertones",
        examples: ["In every bite is a story thirty years in the making", "Where flame transforms hunger into hope", "This is where ritual becomes reality"]
      },
      adventurous_bold: {
        name: "Adventurous & Bold",
        emoji: "‚ö°",
        description: "High-energy rants, dare-you-challenges, visceral language",
        examples: ["Forget everything you know about this", "We're not here to play it safe", "You either get it, or you don't"]
      },
      nostalgic_warm: {
        name: "Nostalgic & Warm",
        emoji: "üî•",
        description: "Subtle sentiment under sarcasm, family/heritage themes",
        examples: ["My grandmother would recognize this craft", "This is what real looks like", "Some things are worth the long way around"]
      }
    };

    // Tone Selection Styling
    document.querySelectorAll('input[name="toneStyle"]').forEach(radio => {
      radio.addEventListener('change', function() {
        document.querySelectorAll('input[name="toneStyle"]').forEach(r => {
          r.parentElement.querySelector('div').style.borderColor = '#e0e0e0';
          r.parentElement.querySelector('div').style.background = 'white';
        });
        this.parentElement.querySelector('div').style.borderColor = '#667eea';
        this.parentElement.querySelector('div').style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%)';
        
        updateTonePreview();
      });
    });

    function updateTonePreview() {
      const selectedTone = document.querySelector('input[name="toneStyle"]:checked');
      const preview = document.getElementById('tonePreview');
      
      if (selectedTone) {
        const tone = toneProfiles[selectedTone.value];
        preview.innerHTML = `
          <div style="margin-bottom: 10px;">
            <span style="font-weight: 600; color: #667eea;">Voice Tone: ${tone.emoji} ${tone.name}</span>
          </div>
          <div style="font-size: 13px; color: #666; margin-bottom: 12px;">${tone.description}</div>
          <div style="font-size: 12px; color: #999;">
            <strong>Examples:</strong><br>
            ${tone.examples.map(ex => `‚Ä¢ ${ex}`).join('<br>')}
          </div>
        `;
        preview.style.borderStyle = 'solid';
        preview.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%)';
      }
    }

    document.getElementById('next5').addEventListener('click', () => {
      showStep(6);
    });

    document.getElementById('next6').addEventListener('click', () => {
      const businessName = document.getElementById('businessName').value;
      const heroProduct = document.getElementById('heroProduct').value;
      const tone = document.querySelector('input[name="toneStyle"]:checked');

      if (!businessName || !heroProduct || !tone) {
        alert('Please fill in Business Name, Hero Product, and select a Voice Tone');
        return;
      }

      showStep(7);
      updateReviewSection();
    });

    document.getElementById('back6').addEventListener('click', () => showStep(5));
    document.getElementById('back7').addEventListener('click', () => showStep(6));

    function updateReviewSection() {
      document.getElementById('reviewBusiness').textContent = formState.businessType.charAt(0).toUpperCase() + formState.businessType.slice(1);
      document.getElementById('reviewProduct').textContent = document.getElementById('heroProduct').value;
      document.getElementById('reviewDiff').textContent = document.getElementById('differentiation').value.substring(0, 50) + '...';
      document.getElementById('reviewEmotion').textContent = document.getElementById('emotion').value;
      
      const website = document.getElementById('website').value;
      document.getElementById('reviewWebsite').href = website;
      document.getElementById('reviewWebsite').textContent = website || 'Not provided';
      
      document.getElementById('reviewLocations').textContent = formState.selectedLocation;
      const brollMap = { all: 'All B-Roll', mostly: 'Mostly B-Roll', some: 'Some B-Roll', none: 'No B-Roll' };
      document.getElementById('reviewBroll').textContent = brollMap[formState.brollStrategy];
      
      const selectedTone = document.querySelector('input[name="toneStyle"]:checked');
      document.getElementById('reviewTone').textContent = selectedTone ? toneProfiles[selectedTone.value].name : '‚Äî';
      
      const age = document.getElementById('ageRange').value;
      const psycho = document.getElementById('psychographic').value;
      document.getElementById('reviewAudience').textContent = `${age} | ${psycho}`;
      
      document.getElementById('reviewActivities').textContent = formState.behindTheScenes.length + ' selected';
    }

    document.getElementById('finalGenerate').addEventListener('click', async () => {
      if (!apiKey || apiKey.length < 10) {
        alert('‚ö†Ô∏è Please enter your Perplexity API key at the top of the form first.');
        apiKeyInput.focus();
        return;
      }

      const businessName = document.getElementById('businessName').value;
      const heroProduct = document.getElementById('heroProduct').value;
      const differentiation = document.getElementById('differentiation').value;
      const boundaries = document.getElementById('boundaries').value;
      const emotion = document.getElementById('emotion').value;
      const heritage = document.getElementById('heritage').value;
      const website = document.getElementById('website').value;
      const instagram = document.getElementById('socialInstagram').value;
      const selectedTone = document.querySelector('input[name="toneStyle"]:checked');
      const toneStyle = selectedTone ? toneProfiles[selectedTone.value].name : 'Default';
      const ageRange = document.getElementById('ageRange').value;
      const psychographic = document.getElementById('psychographic').value;
      const sceneCount = document.getElementById('sceneCount').value;

      const enhancedPrompt = `You are Anthony Bourdain writing a production VO script for a ${formState.businessType} business.

BUSINESS PROFILE:
- Name: ${businessName}
- Type: ${formState.businessType}
- Hero Product: ${heroProduct}
- Unique Differentiation: ${differentiation}
- Boundaries (What they refuse): ${boundaries}
- Heritage/Origin: ${heritage || 'N/A'}
- Website: ${website}
- Instagram: ${instagram}

BRAND VOICE (UVP):
- Emotional Target: ${emotion}
- Voice Tone: ${toneStyle}

AUDIENCE:
- Age Range: ${ageRange}
- Psychographic: ${psychographic}
- Gender Focus: ${formState.gender}

PRODUCTION DETAILS:
- Hero Location: ${formState.selectedLocation}
- Locations: ${formState.locations.join(', ')}
- B-Roll Strategy: ${formState.brollStrategy}
- Activities: ${formState.behindTheScenes.join(', ')}

Generate ${sceneCount} cinematic scenes, each 12-15 seconds of VO that:

1. Opens with an authentic, defiant hook pulling from the brand's UVP
2. Weaves in sensory details and the hero product naturally
3. Reflects the tone (${toneStyle}) - cynical wit, poetic depth, bold adventure, or warm nostalgia
4. Builds visual momentum through the described locations
5. Ends with emotional/philosophical payoff that ties to the core brand message

For EACH scene provide:
SCENE [#]: [TITLE]
Duration: [X] seconds
TONE: ${toneStyle}
VO: [Full narrative - make it feel like lived truth, not marketing]

SHOT BREAKDOWN for Scene [#]:
Extract key visual moments from the VO and describe:
- Shot [#]: [Timecode] | [What to film] | [Focal point] | [Location] | [Details]

After all scenes, provide:
PRODUCTION RECOMMENDATIONS:
- Equipment needed
- Crew roles
- Estimated timeline
- Key production notes for ${formState.businessType}

Make this feel like Bourdain wrote it FOR this specific business. Authentic, defiant, real.`;

      try {
        const btn = document.getElementById('finalGenerate');
        const originalText = btn.textContent;
        btn.textContent = '‚è≥ Generating...';
        btn.disabled = true;

        const response = await fetch('https://api.perplexity.ai/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'sonar',
            messages: [
              {
                role: 'user',
                content: enhancedPrompt
              }
            ],
            max_tokens: 4000
          })
        });

        if (!response.ok) {
          throw new Error('API request failed: ' + response.statusText);
        }

        const data = await response.json();
        const storyboardContent = data.choices[0].message.content;

        // Create PDF with all information
        const pdfContent = `
PRODUCTION STORYBOARD
${businessName}

Generated: ${new Date().toLocaleDateString()}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

BRAND BRIEF:
Business: ${businessName}
Hero Product: ${heroProduct}
Unique Value: ${differentiation}
What We Refuse: ${boundaries}
Emotional Target: ${emotion}
Voice Tone: ${toneStyle}

Video Settings:
- Locations: ${formState.locations.join(', ')}
- B-Roll Strategy: ${formState.brollStrategy}
- Target Audience: ${ageRange} | ${psychographic}
- Gender Focus: ${formState.gender}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${storyboardContent}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

LINKS & SOCIAL:
Website: ${website}
Instagram: ${instagram}

EOF`;

        // Copy to clipboard for now (PDF generation would require additional library)
        navigator.clipboard.writeText(pdfContent).then(() => {
          alert('‚úÖ Storyboard copied to clipboard!\n\nNote: Full PDF export feature coming soon.\n\n' + storyboardContent);
        });

        btn.textContent = originalText;
        btn.disabled = false;
      } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Error generating storyboard.\n\nError: ' + error.message);
        
        const btn = document.getElementById('finalGenerate');
        btn.textContent = 'üé¨ Generate Storyboard & PDF';
        btn.disabled = false;
      }
    });

    // ============================================
    // INITIALIZATION
    // ============================================

    document.addEventListener('DOMContentLoaded', () => {
      updateGenderPreview();
      updateSidebar();
    });
  </script>
</body>
</html>