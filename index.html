<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storyboard AI - Video Goal Router</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    #goalScreen { display: grid; gap: 20px; }
    #goalScreen.hidden { display: none; }
    #wizardScreen.hidden { display: none; }
    
    .goal-header { background: white; padding: 40px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
    .goal-header h1 { font-size: 32px; color: #333; margin-bottom: 10px; }
    .goal-header p { font-size: 16px; color: #666; }
    
    .goals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
    .goal-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s ease; text-align: center; }
    .goal-card:hover { border-color: #667eea; box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2); transform: translateY(-4px); }
    .goal-card.selected { border-color: #667eea; background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%); }
    .goal-icon { font-size: 48px; margin-bottom: 15px; }
    .goal-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 10px; }
    .goal-desc { font-size: 13px; color: #666; line-height: 1.5; margin-bottom: 12px; }
    .goal-specs { font-size: 12px; color: #999; background: #f5f5f5; padding: 10px; border-radius: 6px; }
    
    .goal-continue { text-align: center; margin-top: 30px; }
    .btn-continue { padding: 14px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .btn-continue:disabled { opacity: 0.5; cursor: not-allowed; }
    
    #wizardScreen { display: grid; grid-template-columns: 1fr 280px; gap: 30px; }
    
    .api-section { grid-column: 1 / -1; background: white; padding: 20px; border-radius: 12px; border: 2px solid #e0e0e0; display: flex; gap: 15px; align-items: flex-end; }
    .api-group { flex: 1; }
    .api-label { display: block; font-weight: 600; color: #333; margin-bottom: 8px; font-size: 14px; }
    .api-input { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
    .api-btn { padding: 12px 20px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600; }
    
    .progress { grid-column: 1 / -1; background: white; padding: 20px; border-radius: 12px; }
    .progress-bar { height: 4px; background: #e0e0e0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s; }
    
    .wizard-content { background: white; border-radius: 12px; padding: 40px; }
    .step { display: none; }
    .step.active { display: block; }
    .step.hidden { display: none !important; }
    
    .step h2 { font-size: 28px; color: #333; margin-bottom: 10px; }
    .step p { font-size: 15px; color: #666; margin-bottom: 30px; }
    
    .form-group { margin-bottom: 25px; }
    .form-label { display: block; font-weight: 600; color: #333; margin-bottom: 12px; font-size: 14px; }
    .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
    .form-textarea { resize: vertical; min-height: 80px; }
    
    .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
    .option-card { border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; background: white; transition: all 0.3s; }
    .option-card:hover { border-color: #667eea; }
    .option-card.selected { border-color: #667eea; background: rgba(102, 126, 234, 0.08); }
    .option-icon { font-size: 24px; margin-bottom: 8px; }
    .option-name { font-weight: 600; color: #333; font-size: 13px; }
    
    .step-actions { display: flex; gap: 10px; margin-top: 30px; }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-secondary { background: #f0f0f0; color: #666; margin-right: auto; }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    
    .sidebar { background: white; border-radius: 12px; padding: 25px; height: fit-content; position: sticky; top: 20px; }
    .sidebar h3 { font-size: 18px; color: #333; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0; }
    .summary-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 13px; }
    .summary-label { font-weight: 600; color: #666; }
    .summary-value { color: #667eea; font-weight: 500; }
    
    @media (max-width: 1024px) {
      #wizardScreen { grid-template-columns: 1fr; }
      .sidebar { position: static; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="goalScreen">
      <div class="goal-header">
        <h1>üé¨ What's Your Video Goal?</h1>
        <p>Select the type of video you want to create. We'll customize the entire process for your goal.</p>
      </div>
      
      <div class="goals-grid">
        <div class="goal-card" onclick="selectGoal('awareness', this)">
          <div class="goal-icon">üìà</div>
          <div class="goal-title">Brand Awareness</div>
          <div class="goal-desc">Build recognition & emotional connection</div>
          <div class="goal-specs">30-60s ‚Ä¢ 70% B-Roll</div>
        </div>
        <div class="goal-card" onclick="selectGoal('launch', this)">
          <div class="goal-icon">üöÄ</div>
          <div class="goal-title">Product Launch</div>
          <div class="goal-desc">Introduce something new & drive clicks</div>
          <div class="goal-specs">15-30s ‚Ä¢ Problem-Solution</div>
        </div>
        <div class="goal-card" onclick="selectGoal('promo', this)">
          <div class="goal-icon">üî•</div>
          <div class="goal-title">Flash Sale/Promo</div>
          <div class="goal-desc">Create urgency & immediate sales</div>
          <div class="goal-specs">10-15s ‚Ä¢ Scarcity-Focused</div>
        </div>
        <div class="goal-card" onclick="selectGoal('team', this)">
          <div class="goal-icon">üë•</div>
          <div class="goal-title">Team Spotlight</div>
          <div class="goal-desc">Show culture & attract talent</div>
          <div class="goal-specs">20-45s ‚Ä¢ Personality-Driven</div>
        </div>
        <div class="goal-card" onclick="selectGoal('showcase', this)">
          <div class="goal-icon">‚ú®</div>
          <div class="goal-title">Business Showcase</div>
          <div class="goal-desc">General credibility & discovery</div>
          <div class="goal-specs">15-30s ‚Ä¢ Craft-Focused</div>
        </div>
      </div>
      
      <div class="goal-continue">
        <button class="btn-continue" onclick="continueToWizard()" id="continueBtn" disabled>Continue ‚Üí</button>
      </div>
    </div>

    <div id="wizardScreen" class="hidden">
      <div style="grid-column: 1 / -1;">
        <div class="api-section">
          <div class="api-group" style="flex: 1;">
            <label class="api-label">üîë Perplexity API Key</label>
            <input type="password" id="apiInput" class="api-input" placeholder="pplx-xxxxxxxxxxxxxxxxxxxxxxxx">
            <div style="font-size: 11px; color: #999; margin-top: 6px;">Get from <a href="https://www.perplexity.ai/settings/api" target="_blank" style="color: #667eea;">Perplexity Settings</a></div>
          </div>
          <button id="toggleApiBtn" class="api-btn" onclick="toggleApiVis()">üëÅÔ∏è Show</button>
        </div>
        
        <div class="progress">
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
          <div style="text-align: center; font-size: 12px; color: #666; margin-top: 10px;">
            <span id="stepCounter">Step 1 of 5</span>
          </div>
        </div>
      </div>

      <div class="wizard-content">
        <!-- STEP 1: BUSINESS TYPE -->
        <div class="step active" data-step="1">
          <h2>What's Your Business Type?</h2>
          <p>This helps us tailor locations and activities</p>
          <div class="options-grid" id="businessGrid">
            <label class="option-card" onclick="selectBusiness('restaurant', this)">
              <div class="option-icon">üçΩÔ∏è</div>
              <div class="option-name">Restaurant</div>
            </label>
            <label class="option-card" onclick="selectBusiness('cafe', this)">
              <div class="option-icon">‚òï</div>
              <div class="option-name">Cafe</div>
            </label>
            <label class="option-card" onclick="selectBusiness('bar', this)">
              <div class="option-icon">üç∏</div>
              <div class="option-name">Bar</div>
            </label>
            <label class="option-card" onclick="selectBusiness('hotel', this)">
              <div class="option-icon">üè®</div>
              <div class="option-name">Hotel</div>
            </label>
            <label class="option-card" onclick="selectBusiness('wellness', this)">
              <div class="option-icon">üí™</div>
              <div class="option-name">Wellness</div>
            </label>
            <label class="option-card" onclick="selectBusiness('education', this)">
              <div class="option-icon">üìö</div>
              <div class="option-name">Education</div>
            </label>
          </div>
          <div class="step-actions">
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 2: PRODUCT INFO (Launch Only) -->
        <div class="step hidden" data-step="2" id="productStep">
          <h2>Tell Us About Your Product</h2>
          <p>What problem does it solve?</p>
          <div class="form-group">
            <label class="form-label">Problem it solves</label>
            <input type="text" id="problem" class="form-input" placeholder="e.g., People spend too much time on slow coffee machines">
          </div>
          <div class="form-group">
            <label class="form-label">Hero Feature</label>
            <input type="text" id="heroFeature" class="form-input" placeholder="e.g., 30-second brew">
          </div>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 2: PROMO INFO (Promo Only) -->
        <div class="step hidden" data-step="2" id="promoStep">
          <h2>Promo Details</h2>
          <p>What's the offer and time limit?</p>
          <div class="form-group">
            <label class="form-label">Offer</label>
            <input type="text" id="offer" class="form-input" placeholder="e.g., 40% off all memberships">
          </div>
          <div class="form-group">
            <label class="form-label">Time Limit</label>
            <select id="timeLimit" class="form-select">
              <option>Select...</option>
              <option>24 hours only</option>
              <option>48 hours only</option>
              <option>This weekend</option>
              <option>Until Friday</option>
            </select>
          </div>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 2: TEAM SELECTION (Team Only) -->
        <div class="step hidden" data-step="2" id="teamStep">
          <h2>Who Are We Featuring?</h2>
          <p>Add 1-3 team members</p>
          <div id="teamMembers"></div>
          <button class="btn btn-secondary" onclick="addTeamMember()" style="margin-top: 20px;">+ Add Member</button>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 3: LOCATIONS -->
        <div class="step hidden" data-step="3" id="locationStep">
          <h2>Where Should We Film?</h2>
          <p id="locationDesc"></p>
          <div class="options-grid" id="locationGrid"></div>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 4: B-ROLL STRATEGY -->
        <div class="step hidden" data-step="4" id="brollStep">
          <h2>B-Roll Strategy</h2>
          <p>How much background footage vs talking head?</p>
          <div class="options-grid">
            <label class="option-card" onclick="selectBroll('mostly', this)">
              <div class="option-icon">üé¨</div>
              <div class="option-name">Mostly B-Roll (70%)</div>
            </label>
            <label class="option-card" onclick="selectBroll('some', this)">
              <div class="option-icon">üé•</div>
              <div class="option-name">Some B-Roll (50%)</div>
            </label>
            <label class="option-card" onclick="selectBroll('none', this)">
              <div class="option-icon">üì±</div>
              <div class="option-name">No B-Roll</div>
            </label>
          </div>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
          </div>
        </div>

        <!-- STEP 5: BRAND & VOICE -->
        <div class="step hidden" data-step="5" id="voiceStep">
          <h2>Brand & Voice</h2>
          <p>Tell us about your business</p>
          <div class="form-group">
            <label class="form-label">Business Name</label>
            <input type="text" id="businessName" class="form-input" placeholder="e.g., Jerusalem Grill">
          </div>
          <div class="form-group">
            <label class="form-label">Unique Value</label>
            <input type="text" id="uvp" class="form-input" placeholder="e.g., 30 years of authentic flavor">
          </div>
          <div class="form-group">
            <label class="form-label">Reel Length</label>
            <select id="reelLength" class="form-select">
              <option value="15">15 seconds</option>
              <option value="30" selected>30 seconds</option>
              <option value="45">45 seconds</option>
              <option value="60">60 seconds</option>
            </select>
          </div>
          <div class="step-actions">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="generateStoryboard()">‚ú® Generate ‚Üí</button>
          </div>
        </div>
      </div>

      <aside class="sidebar">
        <h3>Summary</h3>
        <div class="summary-row">
          <span class="summary-label">Goal:</span>
          <span class="summary-value" id="summaryGoal">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Business:</span>
          <span class="summary-value" id="summaryBiz">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Reel:</span>
          <span class="summary-value" id="summaryReel">30s</span>
        </div>
      </aside>
    </div>
  </div>

  <script>
    let state = {
      goal: null,
      business: null,
      locations: [],
      broll: null,
      team: [],
      reel: 30
    };

    const businessData = {
      restaurant: { name: 'Restaurant', locations: ['Kitchen', 'Dining', 'Counter', 'Prep Station'] },
      cafe: { name: 'Cafe', locations: ['Counter', 'Seating', 'Kitchen', 'Patio'] },
      bar: { name: 'Bar', locations: ['Bar Counter', 'Seating', 'Dance Floor', 'Lounge'] },
      hotel: { name: 'Hotel', locations: ['Lobby', 'Guest Room', 'Restaurant', 'Spa'] },
      wellness: { name: 'Wellness', locations: ['Training Room', 'Recovery', 'Studio', 'Outdoor'] },
      education: { name: 'Education', locations: ['Classroom', 'Lab', 'Studio', 'Office'] }
    };

    let currentStep = 1;
    let visibleSteps = [];

    function selectGoal(goal, elem) {
      state.goal = goal;
      document.querySelectorAll('.goal-card').forEach(c => c.classList.remove('selected'));
      elem.classList.add('selected');
      document.getElementById('continueBtn').disabled = false;
      const labels = { awareness: 'üìà Brand Awareness', launch: 'üöÄ Product Launch', promo: 'üî• Flash Sale', team: 'üë• Team Spotlight', showcase: '‚ú® Showcase' };
      document.getElementById('summaryGoal').textContent = labels[goal];
    }

    function continueToWizard() {
      if (!state.goal) return;
      document.getElementById('goalScreen').classList.add('hidden');
      document.getElementById('wizardScreen').classList.remove('hidden');
      configureStepsForGoal();
      updateStepDisplay();
    }

    function configureStepsForGoal() {
      const allSteps = document.querySelectorAll('.step');
      allSteps.forEach(s => s.classList.add('hidden'));
      
      document.querySelector('[data-step="1"]').classList.remove('hidden');
      
      if (state.goal === 'launch') document.getElementById('productStep').classList.remove('hidden');
      else if (state.goal === 'promo') document.getElementById('promoStep').classList.remove('hidden');
      else if (state.goal === 'team') document.getElementById('teamStep').classList.remove('hidden');
      
      if (state.goal !== 'promo' && state.goal !== 'team') {
        document.getElementById('locationStep').classList.remove('hidden');
      }
      
      document.getElementById('brollStep').classList.remove('hidden');
      document.getElementById('voiceStep').classList.remove('hidden');
      
      visibleSteps = Array.from(document.querySelectorAll('.step')).filter(s => !s.classList.contains('hidden'));
      currentStep = 1;
    }

    function selectBusiness(biz, elem) {
      state.business = biz;
      document.querySelectorAll('#businessGrid .option-card').forEach(c => c.classList.remove('selected'));
      elem.classList.add('selected');
      document.getElementById('summaryBiz').textContent = businessData[biz].name;
    }

    function selectBroll(type, elem) {
      state.broll = type;
      document.querySelectorAll('#brollStep .option-card').forEach(c => c.classList.remove('selected'));
      elem.classList.add('selected');
    }

    function addTeamMember() {
      if (state.team.length >= 3) return;
      const idx = state.team.length;
      state.team.push({ name: '', role: '' });
      const cont = document.getElementById('teamMembers');
      const div = document.createElement('div');
      div.className = 'form-group';
      div.innerHTML = `<label class="form-label">Team Member ${idx + 1}</label>
        <input type="text" placeholder="Name" class="form-input" style="margin-bottom: 8px;" onchange="state.team[${idx}].name = this.value;">
        <input type="text" placeholder="Role" class="form-input" onchange="state.team[${idx}].role = this.value;">`;
      cont.appendChild(div);
    }

    function nextStep() {
      if (state.goal === 'launch' && currentStep === 1) currentStep = 2;
      else if (state.goal === 'promo' && currentStep === 1) currentStep = 2;
      else if (state.goal === 'team' && currentStep === 1) currentStep = 2;
      else if (currentStep === 2 && (state.goal === 'launch' || state.goal === 'promo' || state.goal === 'team')) currentStep = state.goal === 'team' ? 4 : 3;
      else if (currentStep === 2) currentStep = 3;
      else currentStep++;
      
      updateStepDisplay();
    }

    function prevStep() {
      if (currentStep > 1) currentStep--;
      updateStepDisplay();
    }

    function updateStepDisplay() {
      visibleSteps.forEach((s, i) => {
        const stepNum = parseInt(s.dataset.step);
        s.classList.remove('active');
        if (i === currentStep - 1) s.classList.add('active');
      });
      
      if (state.business && !document.getElementById('locationGrid').innerHTML) {
        populateLocations();
      }
      
      updateProgress();
    }

    function populateLocations() {
      if (!state.business) return;
      const locs = businessData[state.business].locations;
      document.getElementById('locationDesc').textContent = `Choose primary location(s) for ${businessData[state.business].name}`;
      const grid = document.getElementById('locationGrid');
      grid.innerHTML = locs.map(loc => 
        `<label class="option-card" onclick="selectLocation('${loc}', this)">
          <div class="option-icon">üìç</div>
          <div class="option-name">${loc}</div>
        </label>`
      ).join('');
    }

    function selectLocation(loc, elem) {
      if (!state.locations.includes(loc)) state.locations = [loc];
      document.querySelectorAll('#locationGrid .option-card').forEach(c => c.classList.remove('selected'));
      elem.classList.add('selected');
    }

    function updateProgress() {
      const pct = (currentStep / visibleSteps.length) * 100;
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('stepCounter').textContent = `Step ${currentStep} of ${visibleSteps.length}`;
    }

    function toggleApiVis() {
      const input = document.getElementById('apiInput');
      const btn = document.getElementById('toggleApiBtn');
      if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'üôà Hide';
      } else {
        input.type = 'password';
        btn.textContent = 'üëÅÔ∏è Show';
      }
    }

    async function generateStoryboard() {
      const apiKey = document.getElementById('apiInput').value;
      if (!apiKey) {
        alert('Enter API key');
        return;
      }

      const biz = document.getElementById('businessName').value || 'Your Business';
      const prompts = {
        awareness: `Create a BRAND AWARENESS video storyboard for ${biz}. ${document.getElementById('uvp').value}. Include 3 scenes with voiceover and shot lists.`,
        launch: `Create a PRODUCT LAUNCH storyboard. Problem: ${document.getElementById('problem').value}. Feature: ${document.getElementById('heroFeature').value}. Include 3 scenes.`,
        promo: `Create a FLASH SALE storyboard. Offer: ${document.getElementById('offer').value}. Time: ${document.getElementById('timeLimit').value}. Make it urgent. 3 scenes.`,
        team: `Create a TEAM SPOTLIGHT storyboard featuring ${state.team.map(t => t.name).join(', ')}. Show personality and culture. 3 scenes.`,
        showcase: `Create a BUSINESS SHOWCASE storyboard for ${biz}. ${document.getElementById('uvp').value}. 3 scenes, ${document.getElementById('reelLength').value}s duration.`
      };

      try {
        const resp = await fetch('https://api.perplexity.ai/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
          body: JSON.stringify({ model: 'sonar', messages: [{ role: 'user', content: prompts[state.goal] }], max_tokens: 3000 })
        });
        if (!resp.ok) throw new Error('API Error');
        const data = await resp.json();
        const win = window.open('', '_blank');
        win.document.write(`<pre>${data.choices[0].message.content}</pre>`);
      } catch (e) {
        alert('Error: ' + e.message);
      }
    }
  </script>
</body>
</html>
