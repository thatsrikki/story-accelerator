<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentic Story Accelerator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(94, 82, 64, 0.2);
            --color-error: var(--color-red-500);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: var(--color-gray-300);
                --color-border: rgba(119, 124, 124, 0.3);
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px; line-height: 1.6; color: var(--color-text); background-color: var(--color-background); padding: 24px; }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 32px; }
        h1 { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
        .subtitle { font-size: 14px; color: var(--color-text-secondary); margin-bottom: 24px; }
        .progress-bar { display: flex; justify-content: center; gap: 16px; margin-top: 24px; }
        .progress-step { width: 40px; height: 40px; border-radius: 50%; background-color: var(--color-surface); border: 2px solid var(--color-border); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--color-text-secondary); transition: all 0.3s ease; }
        .progress-step.active { background-color: var(--color-primary); border-color: var(--color-primary); color: white; }
        .progress-step.completed { background-color: var(--color-teal-700); border-color: var(--color-teal-700); color: white; }
        .phase { display: none; background-color: var(--color-surface); border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px; }
        .phase.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .phase-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .phase-description { font-size: 14px; color: var(--color-text-secondary); margin-bottom: 24px; }
        .form-group { margin-bottom: 24px; }
        label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        .required { color: var(--color-error); }
        input, select, textarea { width: 100%; min-height: 44px; padding: 12px; font-size: 14px; font-family: inherit; color: var(--color-text); background-color: var(--color-background); border: 1px solid var(--color-border); border-radius: 8px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1); }
        input[readonly], textarea[readonly] { background-color: var(--color-surface); cursor: not-allowed; opacity: 0.7; }
        .help-text { font-size: 12px; color: var(--color-text-secondary); font-style: italic; margin-top: 4px; }
        .note { font-size: 12px; color: var(--color-text-secondary); margin-top: 4px; padding: 8px; background-color: rgba(33, 128, 141, 0.05); border-radius: 6px; }
        .btn-primary, .btn-secondary { min-height: 44px; padding: 12px 24px; font-size: 14px; font-weight: 500; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background-color: var(--color-primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-hover); }
        .btn-primary:disabled { background-color: var(--color-border); cursor: not-allowed; opacity: 0.6; }
        .btn-secondary { background-color: transparent; color: var(--color-primary); border: 1px solid var(--color-primary); }
        .btn-secondary:hover { background-color: rgba(33, 128, 141, 0.1); }
        .navigation { display: flex; justify-content: space-between; gap: 16px; margin-top: 32px; }
        .hidden { display: none !important; }
        #loadingSpinner { text-align: center; padding: 24px; color: var(--color-text-secondary); }
        .storyboard-table { width: 100%; border-collapse: collapse; margin: 24px 0; background-color: var(--color-surface); border-radius: 8px; overflow: hidden; }
        .storyboard-table th { background-color: var(--color-primary); color: white; padding: 12px; text-align: left; font-weight: 600; }
        .storyboard-table td { padding: 12px; border-bottom: 1px solid var(--color-border); vertical-align: top; }
        .storyboard-table tr:last-child td { border-bottom: none; }
        .storyboard-table tr:nth-child(even) { background-color: rgba(0, 0, 0, 0.02); }
        .action-buttons { display: flex; gap: 16px; margin-top: 24px; }
        @media (max-width: 768px) { body { padding: 16px; } .phase { padding: 24px; } .navigation { flex-direction: column; } .navigation button { width: 100%; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Authentic Story Accelerator</h1>
            <p class="subtitle">Generate Bourdain-Style Storyboards for Your Business in Under 5 Minutes</p>
            <div class="progress-bar">
                <div class="progress-step active" data-phase="1">1</div>
                <div class="progress-step" data-phase="2">2</div>
                <div class="progress-step" data-phase="3">3</div>
                <div class="progress-step" data-phase="4">4</div>
            </div>
        </header>

        <div id="phase1" class="phase active">
            <h2 class="phase-title">Phase 1: Business Setup</h2>
            <p class="phase-description">Define your business type and reel objectives</p>
            <div class="form-group"><label>Business Type <span class="required">*</span></label><select id="businessType" required><option value="">Select...</option><option value="food">Food & Beverage</option><option value="fitness">Wellness/Fitness</option><option value="travel">Travel/Adventure</option></select></div>
            <div class="form-group"><label>Reel Objective <span class="required">*</span></label><select id="reelObjective" required><option value="">Select...</option><option value="awareness">Awareness/Brand Intro</option><option value="booking">Booking/Engagement</option></select></div>
            <div class="form-group"><label>Target Audience <span class="required">*</span></label><select id="targetAudience" required><option value="">Select...</option><option value="rebels">18-24: Rebels</option><option value="hustlers">25-40: Urban Hustlers</option></select></div>
            <div class="form-group"><label>Tone <span class="required">*</span></label><select id="toneIntensity" required><option value="">Select...</option><option value="cynical">Cynical & Witty</option><option value="bold">Adventurous & Bold</option></select></div>
            <div class="form-group"><label>Reel Length <span class="required">*</span></label><select id="reelLength" required><option value="">Select...</option><option value="30">30 seconds (4 scenes)</option><option value="60">60 seconds (5 scenes)</option></select></div>
            <div class="form-group"><label>Hero Product <span class="required">*</span></label><input type="text" id="heroProduct" placeholder="Your main product/service" required></div>
            <div class="form-group"><label>Location/Setting <span class="required">*</span></label><select id="locationSetting" required><option value="">Select...</option><option value="indoor">Indoor</option><option value="outdoor">Outdoor</option></select></div>
            <div class="navigation">
                <button class="btn-secondary" onclick="loadExample()">Load Example</button>
                <button class="btn-primary" id="nextBtn1" onclick="nextPhase()">Next</button>
            </div>
        </div>

        <div id="phase2" class="phase">
            <h2 class="phase-title">Phase 2: Business Details</h2>
            <div class="form-group"><label>Business Name <span class="required">*</span></label><input type="text" id="businessName" placeholder="Your business name" required></div>
            <div class="form-group"><label>Location <span class="required">*</span></label><input type="text" id="location" placeholder="City/neighborhood" required></div>
            <div class="form-group"><label>Unique Value <span class="required">*</span></label><textarea id="uniqueValue" rows="4" placeholder="What makes you different?" required></textarea></div>
            <div class="form-group"><label>Perplexity API Key <span class="required">*</span></label><input type="password" id="apiKey" placeholder="pplx-xxxxx" required><p class="note">ðŸ”’ Stored only in browser session</p></div>
            <div class="navigation">
                <button class="btn-secondary" onclick="previousPhase()">Previous</button>
                <button class="btn-primary" id="nextBtn2" onclick="nextPhase()">Next</button>
            </div>
        </div>

        <div id="phase3" class="phase">
            <h2 class="phase-title">Phase 3: Generate Story</h2>
            <button class="btn-primary" id="generateBtn" onclick="generateStory()" style="width: 100%; margin-bottom: 24px;">Generate Story with AI</button>
            <div id="loadingSpinner" class="hidden"><p style="font-size: 16px; margin-bottom: 12px;">ðŸŽ¬ Generating...</p><p style="font-size: 12px; margin-top: 16px;">This may take 10-30 seconds</p></div>
            <div id="generatedContent" class="hidden">
                <div class="form-group"><label>Title Hook</label><input type="text" id="titleHook" readonly></div>
                <div class="form-group"><label>Scene 1 VO</label><textarea id="scene1VO" rows="4" readonly></textarea></div>
                <div class="form-group"><label>Scene 2 VO</label><textarea id="scene2VO" rows="4" readonly></textarea></div>
                <div class="form-group"><label>Scene 3 VO</label><textarea id="scene3VO" rows="4" readonly></textarea></div>
                <div class="form-group" id="scene4Group" style="display: none;"><label>Scene 4 VO</label><textarea id="scene4VO" rows="4" readonly></textarea></div>
                <div class="form-group" id="scene5Group" style="display: none;"><label>Scene 5 VO</label><textarea id="scene5VO" rows="4" readonly></textarea></div>
            </div>
            <div id="errorMessage" class="hidden" style="padding: 12px; background-color: rgba(192, 21, 47, 0.1); border-radius: 8px; margin-top: 16px;"></div>
            <div class="navigation">
                <button class="btn-secondary" onclick="previousPhase()">Previous</button>
                <button class="btn-primary" id="nextBtn3" onclick="nextPhase()" disabled>Next</button>
            </div>
        </div>

        <div id="phase4" class="phase">
            <h2 class="phase-title">Phase 4: Your Storyboard</h2>
            <table class="storyboard-table" id="storyboardTable">
                <thead><tr><th>Scene</th><th>Duration</th><th>Narrative VO</th><th>Visual Guide</th></tr></thead>
                <tbody id="storyboardBody"></tbody>
            </table>
            <div class="action-buttons">
                <button class="btn-secondary" onclick="editInputs()">Edit</button>
                <button class="btn-primary" onclick="exportPDF()">Export PDF</button>
            </div>
        </div>
    </div>

    <script>
        let currentPhase = 1;
        let appData = {
            scenes: []
        };

        function nextPhase() {
            if (currentPhase < 4) {
                document.getElementById('phase' + currentPhase).classList.remove('active');
                currentPhase++;
                document.getElementById('phase' + currentPhase).classList.add('active');
                updateProgress();
                window.scrollTo(0, 0);
                if (currentPhase === 4) buildStoryboard();
            }
        }

        function previousPhase() {
            if (currentPhase > 1) {
                document.getElementById('phase' + currentPhase).classList.remove('active');
                currentPhase--;
                document.getElementById('phase' + currentPhase).classList.add('active');
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            document.querySelectorAll('.progress-step').forEach((s, i) => {
                s.classList.remove('active', 'completed');
                if (i + 1 === currentPhase) s.classList.add('active');
                else if (i + 1 < currentPhase) s.classList.add('completed');
            });
        }

        async function generateStory() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                document.getElementById('errorMessage').textContent = 'Please enter your API key';
                document.getElementById('errorMessage').classList.remove('hidden');
                return;
            }

            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loadingSpinner').classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');

            const sceneCount = document.getElementById('reelLength').value === '30' ? 4 : 5;
            document.getElementById('scene4Group').style.display = sceneCount >= 4 ? 'block' : 'none';
            document.getElementById('scene5Group').style.display = sceneCount >= 5 ? 'block' : 'none';

            try {
                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'sonar-pro',
                        messages: [{
                            role: 'system',
                            content: 'You are a Bourdain-style video storyboard writer creating gritty, sensory-driven voiceover scripts.'
                        }, {
                            role: 'user',
                            content: `Create a ${sceneCount}-scene storyboard for ${document.getElementById('businessName').value}. Format as:
TITLE: [title]
SCENE 1 VO: [80 words]
SCENE 2 VO: [80 words]
SCENE 3 VO: [80 words]
${sceneCount >= 4 ? 'SCENE 4 VO: [80 words]' : ''}
${sceneCount >= 5 ? 'SCENE 5 VO: [80 words]' : ''}`
                        }],
                        max_tokens: 1500
                    })
                });

                if (!response.ok) throw new Error('API error: ' + response.status);
                
                const data = await response.json();
                const text = data.choices[0].message.content;

                document.getElementById('titleHook').value = (text.match(/TITLE:\s*(.+)/)?.[1] || '').trim();
                document.getElementById('scene1VO').value = (text.match(/SCENE 1 VO:\s*(.+?)(?=SCENE 2|$)/s)?.[1] || '').trim();
                document.getElementById('scene2VO').value = (text.match(/SCENE 2 VO:\s*(.+?)(?=SCENE 3|$)/s)?.[1] || '').trim();
                document.getElementById('scene3VO').value = (text.match(/SCENE 3 VO:\s*(.+?)(?=SCENE 4|$)/s)?.[1] || '').trim();
                if (sceneCount >= 4) document.getElementById('scene4VO').value = (text.match(/SCENE 4 VO:\s*(.+?)(?=SCENE 5|$)/s)?.[1] || '').trim();
                if (sceneCount >= 5) document.getElementById('scene5VO').value = (text.match(/SCENE 5 VO:\s*(.+)/s)?.[1] || '').trim();

                appData.scenes = [1, 2, 3, 4, 5].slice(0, sceneCount).map(i => ({
                    num: i,
                    vo: document.getElementById('scene' + i + 'VO').value
                }));

                document.getElementById('generatedContent').classList.remove('hidden');
                document.getElementById('nextBtn3').disabled = false;

            } catch (error) {
                document.getElementById('errorMessage').textContent = 'Error: ' + error.message;
                document.getElementById('errorMessage').classList.remove('hidden');
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        }

        function buildStoryboard() {
            const tbody = document.getElementById('storyboardBody');
            tbody.innerHTML = '';
            const duration = document.getElementById('reelLength').value === '30' ? 7.5 : 12;
            const sceneNames = ['Opening', 'Hook', 'Heart', 'Build', 'Close'];

            appData.scenes.forEach((s, i) => {
                const tr = tbody.insertRow();
                tr.innerHTML = `<td>${i + 1}</td><td>${Math.round(duration)}s</td><td>${s.vo}</td><td>Focal: Hero product<br>Background: Business interior/exterior<br>Lighting: Warm, intimate</td>`;
            });
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            doc.setFontSize(16);
            doc.text(document.getElementById('titleHook').value || 'Storyboard', 20, 20);
            doc.setFontSize(10);
            doc.text('Business: ' + document.getElementById('businessName').value, 20, 30);

            let y = 45;
            appData.scenes.forEach((s, i) => {
                if (y > 250) { doc.addPage(); y = 20; }
                doc.setFont(undefined, 'bold');
                doc.text('Scene ' + (i + 1), 20, y);
                y += 7;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                const lines = doc.splitTextToSize(s.vo, 170);
                doc.text(lines, 20, y);
                y += (lines.length * 4) + 10;
            });

            doc.save(document.getElementById('businessName').value.replace(/\s/g, '_') + '_Storyboard.pdf');
        }

        function editInputs() {
            currentPhase = 1;
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById('phase1').classList.add('active');
            updateProgress();
        }

        function loadExample() {
            document.getElementById('businessType').value = 'food';
            document.getElementById('reelObjective').value = 'booking';
            document.getElementById('targetAudience').value = 'hustlers';
            document.getElementById('toneIntensity').value = 'cynical';
            document.getElementById('reelLength').value = '60';
            document.getElementById('heroProduct').value = 'Kufta Burger';
            document.getElementById('locationSetting').value = 'indoor';
            document.getElementById('businessName').value = 'Jerusalem Grill';
            document.getElementById('location').value = 'Downtown District';
            document.getElementById('uniqueValue').value = 'Authentic Middle Eastern cuisine made fresh daily';
        }
    </script>
</body>
</html>